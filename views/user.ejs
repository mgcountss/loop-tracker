<!DOCTYPE html>
<html>

<%- include('partials/meta') %>

<body>
  <%- include('partials/navbar') %>
    <center><br>
      <div class="topRow">
        <div class="topRowContainer">
          <div class="leftTopRow">
            <img src="<%= user.profile_picture_url %>" id="avatar">
            <div>
              <h1 id="title">
                <%= user.display_name %>
              </h1>
              <h3>@<%= user.username %>
              </h3>
              <div class="bio">
                <%=user.bio%>
              </div>
            </div>
          </div>
          <div class="smallStats">
            <div>
              <h3>Join Rank:</h3>
              <h2>
                #<%= (user.joined_rank-1031).toLocaleString('en-us') %>
              </h2>
            </div>
            <div>
              <h3>Joined:</h3>
              <%=user.joined_at%>
                <h2>
                  <%= moment(user.created_at).format('MMMM Do, YYYY [at] h:mm:ss a') %>
                </h2>
            </div>
          </div>
        </div>
        <hr>
        <div class="mainStats">
          <div>
            <h2>
              <%= (user.follower_count).toLocaleString('en-us') %>
            </h2>
            <h3>Followers</h3>
            <a href="?live=followers">View Live Updates</a>
          </div>
          <div>
            <h2>
              <%= (user.post_count).toLocaleString('en-us') %>
            </h2>
            <h3>Posts</h3>
            <a href="?live=posts">View Live Updates</a>
          </div>
          <div>
            <h2>
              <%= (user.following_count).toLocaleString('en-us') %>
            </h2>
            <h3>Following</h3>
            <a href="?live=following">View Live Updates</a>
          </div>
        </div>
        <hr>
        <button id="viewUploads" onclick="window.location.href='/uploads/<%= user.id %>'">View Uploaded Videos</button>
        <div id="liveCounter">
          <h1 id="live_name">{name}</h1>
          <h2 class="odometer" id="live_count">{count}</h2>
          <h3 id="live_label">{label}</h3>
          <div id="chart"></div>
          <hr><button id="liveButton" onclick="toggleLive()">Disable Live Updates</button>
        </div>
        <div class="charts">
          <div class="chart" id="stats_chart1"></div>
          <div class="chart" id="stats_chart2"></div>
          <div class="chart" id="stats_chart3"></div>
        </div>
        <table>
          <tr>
            <th>Date</th>
            <th>Posts</th>
            <th>Followers</th>
            <th>Following</th>
          </tr>
          <% for (let date in history) { %>
            <tr>
              <td>
                <%= moment(date).format('MMMM Do, YYYY') %>
              </td>
              <td>
                <%= (history[date].post_count).toLocaleString('en-us') %>
              </td>
              <td>
                <%= (history[date].follower_count).toLocaleString('en-us') %>
              </td>
              <td>
                <%= (history[date].following_count).toLocaleString('en-us') %>
              </td>
            </tr>
            <% } %>
        </table>
      </div>
    </center>
    <script>
      let daily_stats = "<%= JSON.stringify(history) %>";
      daily_stats = daily_stats.replace(/&#34;/g, '"');
      daily_stats = JSON.parse(daily_stats);
    </script>
    <script src="/js/highstock.js"></script>
    <script src="/js/user.js"></script>
    <script src="/js/odometer.js"></script>
</body>

</html>